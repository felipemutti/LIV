# LIV VENDAS - Supabase Integration Setup

This application has been updated to use Supabase as its backend. To get it running, you need to set up your Supabase project and tables correctly.

## 1. Set Up Your Supabase Project

1.  Go to [supabase.com](https://supabase.com/) and create a new project.
2.  Once your project is created, navigate to **Project Settings** > **API**.
3.  You will find your **Project URL** and your `anon` **public** key.

## 2. Configure the Application

Open the `supabaseClient.ts` file in the source code and replace the placeholder values with your actual Supabase URL and anon key.

```typescript
// in supabaseClient.ts
const supabaseUrl = 'YOUR_SUPABASE_URL';       // Replace this
const supabaseAnonKey = 'YOUR_SUPABASE_ANON_KEY'; // Replace this
```

## 3. Create Database Tables

You need to create two tables: `profiles` and `leads`. You can use the SQL Editor in your Supabase dashboard to run the following scripts.

### Profiles Table

This table will store user profile information. It is linked to the `auth.users` table.

```sql
-- Create the profiles table
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name character varying NOT NULL,
  email character varying NOT NULL,
  cpf character varying NOT NULL,
  rg character varying NOT NULL,
  profession character varying NOT NULL,
  "maritalStatus" character varying NOT NULL,
  address character varying NOT NULL,
  status character varying NOT NULL DEFAULT 'Pending'::character varying,
  "isAdmin" boolean NOT NULL DEFAULT false,
  signature character varying NOT NULL,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users (id) ON DELETE CASCADE
);

-- Enable Row Level Security (RLS)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- Allow users to view their own profile
CREATE POLICY "Users can view their own profile."
ON public.profiles FOR SELECT
USING (auth.uid() = id);

-- Allow admins to view all profiles
CREATE POLICY "Admins can view all profiles."
ON public.profiles FOR SELECT
USING (
  (SELECT "isAdmin" FROM public.profiles WHERE id = auth.uid()) = true
);

-- Allow users to update their own profile (optional, if needed)
CREATE POLICY "Users can update own profile."
ON public.profiles FOR UPDATE
USING (auth.uid() = id);

-- Allow admins to update all profiles
CREATE POLICY "Admins can update any profile."
ON public.profiles FOR UPDATE
USING (
  (SELECT "isAdmin" FROM public.profiles WHERE id = auth.uid()) = true
);

-- RLS for inserts
CREATE POLICY "Users can insert their own profile."
ON public.profiles FOR INSERT
WITH CHECK (auth.uid() = id);
```

### Leads Table

This table stores the leads indicated by partners.

```sql
-- Create the leads table
CREATE TABLE public.leads (
  id bigint GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  "partnerId" uuid NOT NULL,
  "partnerName" character varying NOT NULL,
  "clientName" character varying NOT NULL,
  "clientContact" character varying NOT NULL,
  status character varying NOT NULL DEFAULT 'Pendente'::character varying,
  commission numeric,
  "paymentDate" timestamp with time zone,
  CONSTRAINT leads_pkey PRIMARY KEY (id),
  CONSTRAINT leads_partnerId_fkey FOREIGN KEY ("partnerId") REFERENCES public.profiles (id) ON DELETE SET NULL
);

-- Enable Row Level Security (RLS)
ALTER TABLE public.leads ENABLE ROW LEVEL SECURITY;

-- Allow partners to view their own leads
CREATE POLICY "Partners can view their own leads."
ON public.leads FOR SELECT
USING (auth.uid() = "partnerId");

-- Allow admins to view all leads
CREATE POLICY "Admins can view all leads."
ON public.leads FOR SELECT
USING (
  (SELECT "isAdmin" FROM public.profiles WHERE id = auth.uid()) = true
);

-- Allow partners to insert their own leads
CREATE POLICY "Partners can create leads."
ON public.leads FOR INSERT
WITH CHECK (auth.uid() = "partnerId");

-- Allow admins to update any lead
CREATE POLICY "Admins can update any lead."
ON public.leads FOR UPDATE
USING (
  (SELECT "isAdmin" FROM public.profiles WHERE id = auth.uid()) = true
);

```

## 4. Final Steps

- Go to **Authentication > Providers** in your Supabase dashboard and make sure `Email` is enabled.
- Go to **Authentication > URL Configuration** and set your **Site URL** to your application's deployment URL. This is important for password reset emails to work correctly.
- (Optional) To disable email confirmation after sign-up for easier testing, you can go to **Authentication > Providers > Email** and turn off "Confirm email".

After completing these steps, your application should be fully functional with Supabase.
